---
title: "Barrow Data 2"
author: "Lydia Vaughn"
date: "March 17, 2018"
output: html_document
---

#Description
```
This script  generates plots from the data files saved in line 249 of the "Barrow Data" script.  The data originate from an field soil warming experiment in Barrow, Alaska.
```
#Code

##Install required packages

These packages only need to be installed once, then this code can be commented out or deleted.

Often, knitr does not like to install from the command window. If this is the case, look to the bottom right window and click on Packages -> Install -> and search for `knitr` in the window that opens.  

Knitr will provide a row of buttons across the top of the top left window in RStudio which allow you to view this document in html format (by clicking on the "Knit HTML" button), as well as run some or all of the code chunks below (by clicking on the "Chunks" button)

```{r}
#uncomment to install packages from command line
#install.packages("knitr")
#install.packages("reshape")
#install.packages("tidyverse")
#install.packages("lubridate")
```

####Read in files
Files were produced using the code: Microwarming_data_formatting_2015_16
In flies used here, outliers have been flagged from the main dataset and omitted from the 15 min-averaged datasets.
```{r}
#Data following QA/QC, with column flagging outliers
flagged <- read.csv('data/2016_organized/flaggedBarrowFile_2016_2.csv', stringsAsFactors=F) 

#Depth-averaged temperatures in each plot for each 15-min interval, outliers omitted.  Includes depths of 15, 10, 15, 20, 35, and 50 cm.  Complete cases only.
mean.15min.depthavg <- read.csv('data/2016_organized/flaggedBarrowFile.15min.avg_2016_4.csv', stringsAsFactors=F) 

#temperatures averaged for each plot and depth for every 15-min interval, outliers omitted
mean.15min <- read.csv('data/2016_organized/flaggedBarrowFile.15min_2016_4.csv', stringsAsFactors=F) 

#temperatures averaged for each probe, every 15-min interval, outliers omitted
mean.15min.probe <- read.csv('data/2016_organized/flaggedBarrowFile.15min.probe_2016_4', stringsAsFactors=F) 

#temperatures averaged for each plot and depth for every 15-min interval, outliers omitted
mean.hour <- read.csv('data/2016_organized/flaggedBarrowFile.1hour_2016_4.csv', stringsAsFactors=F) 

#temperatures averaged for each probe, every 15-min interval, outliers omitted
mean.hour.probe <- read.csv('data/2016_organized/flaggedBarrowFile.1hour.probe_2016_4', stringsAsFactors=F) 

#change for 2015 vs. 2016 data
```

####Packages
```{r}
library(tidyverse)
```

####Format time variables
```{r}
mean.15min.depthavg$time_15min <- as.POSIXct(mean.15min.depthavg$time_15min)
```

####Theme for plot formatting
```{r}
plottheme <- theme_bw() + 
  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank()) +
  theme(axis.text.y = element_text(color="black", size=12)) +
  theme(axis.text.x = element_text(color="black", size=12, angle=90, vjust=.5)) +
  theme(axis.title.y = element_text(size=14)) +
  theme(axis.title.x = element_blank()) +
  theme(legend.title = element_text(size=14)) +
  theme(legend.text = element_text(size=12)) 

```

####Plot 1: depth-averaged temperature difference in heated minus control blocks
```{r}
#15-min averages
p1 <- ggplot(mean.15min.depthavg %>% filter(block %in% c(1,2,3,4)), aes(y=TempDiff, x=time_15min, color=as.factor(as.character(block)))) +
  geom_point(pch=1) +
  ylab(expression("Heated minus control"~(degree*C))) +
  xlab("Time") +
  scale_color_discrete(name="Block") +
  scale_x_datetime(date_labels = "%b %d", date_breaks="3 days") 

p1 + plottheme + theme(legend.position = c(.05, .8)) 

#ggsave("TempDiff_2015.png", path="plots", width = 14, height = 7, dpi = 300)
#ggsave("flagged_TempDiff_15min_2016_5.png", path="plots/outliers_omitted/2016", width = 14, height = 7, dpi = 300)
ggsave("flagged_TempDiff_15min_2015.png", path="plots/outliers_omitted/2015", width = 14, height = 7, dpi = 300)

#1-hour averages
p2 <- ggplot(mean.hour.depthavg %>% filter(block %in% c(1,2,3,4)), aes(y=TempDiff, x=time_hour, color=as.factor(as.character(block)))) +
  geom_point(pch=1) +
  ylab(expression("Heated minus control"~(degree*C))) +
  xlab("Time") +
  scale_color_discrete(name="Block") +
  scale_x_datetime(date_labels = "%b %d", date_breaks="3 days") 

p2 + plottheme + theme(legend.position = c(.05, .8)) 

#ggsave("TempDiff_2015.png", path="plots", width = 14, height = 7, dpi = 300)
#ggsave("flagged_TempDiff_1h_2016_5.png", path="plots/outliers_omitted/2016", width = 14, height = 7, dpi = 300)
ggsave("flagged_TempDiff_1h_2015.png", path="plots/outliers_omitted/2015", width = 14, height = 7, dpi = 300)

#4-hour averages
p3 <- ggplot(mean.4hour.depthavg %>% filter(block %in% c(1,2,3,4)), aes(y=TempDiff, x=time_4hour, color=as.factor(as.character(block)))) +
  geom_point(size = 0.1) +
  geom_line() +
  ylab(expression("Heated minus control"~(degree*C))) +
  xlab("Time") +
  scale_color_discrete(name="Block") +
  scale_x_datetime(date_labels = "%b %d", date_breaks="3 days") 

p3 + plottheme + theme(legend.position = c(.05, .8)) 

#ggsave("TempDiff_2015.png", path="plots", width = 14, height = 7, dpi = 300)
#ggsave("flagged_TempDiff_4h_2016_5.png", path="plots/outliers_omitted/2016", width = 14, height = 7, dpi = 300)
ggsave("flagged_TempDiff_4h_2015.png", path="plots/outliers_omitted/2015", width = 14, height = 7, dpi = 300)

#6-hour averages
p4 <- ggplot(mean.6hour.depthavg %>% filter(block %in% c(1,2,3,4)), aes(y=TempDiff, x=time_6hour, color=as.factor(as.character(block)))) +
  geom_point(size = 0.1) +
  geom_line() +
  ylab(expression("Heated minus control"~(degree*C))) +
  xlab("Time") +
  scale_color_discrete(name="Block") +
  scale_x_datetime(date_labels = "%b %d", date_breaks="3 days") 

p4 + plottheme + theme(legend.position = c(.05, .8)) 

#ggsave("TempDiff_2015.png", path="plots", width = 14, height = 7, dpi = 300)
#ggsave("flagged_TempDiff_6h_2016_5.png", path="plots/outliers_omitted/2016", width = 14, height = 7, dpi = 300)
ggsave("flagged_TempDiff_6h_2015.png", path="plots/outliers_omitted/2015", width = 14, height = 7, dpi = 300)

```

####Plot 2: depth-averaged temperature in heated and unheated blocks, all blocks on one set of axes
```{r}
#15-min averages

#switch tempratures from wide to long format
heatstat.15min.avg <- gather(mean.15min.depthavg, key="Heatstat", value="temp_15min", 3:4)

p5 <- ggplot(heatstat.15min.avg %>% filter(block %in% c(1,2,3,4)), aes(y = temp_15min, x = time_15min, color = Heatstat)) +
   geom_point(pch = 1, size = 0.5) +
   ylab(expression("Temperature" ~ (degree * C))) +
   xlab("Time") +
   scale_color_discrete(name = "Heater status", breaks = c("HeatedMean", "UnheatedMean"), labels = c("Heated", "Unheated")) +
   scale_x_datetime(date_labels = "%b %d", date_breaks="3 days") 
 
 p5 + plottheme + theme(legend.position = c(.1, .9))

#ggsave("UavgHavg_15min_2015.png", path="plots", width = 14, height = 7, dpi = 300)
#ggsave("flagged_UavgHavg_15min_2016_5.png", path="plots/outliers_omitted/2016", width = 14, height = 7, dpi = 300)
ggsave("flagged_UavgHavg_15min_2015.png", path="plots/outliers_omitted/2015", width = 14, height = 7, dpi = 300)

#1-hour averages

#switch tempratures from wide to long format
heatstat.hour.avg <- gather(mean.hour.depthavg, key="Heatstat", value="temp_hour", 3:4)

p6 <- ggplot(heatstat.hour.avg %>% filter(block %in% c(1,2,3,4)), aes(y = temp_hour, x = time_hour, color = Heatstat)) +
   geom_point(pch = 1, size = 0.5) +
   ylab(expression("Temperature" ~ (degree * C))) +
   xlab("Time") +
   scale_color_discrete(name = "Heater status", breaks = c("HeatedMean", "UnheatedMean"), labels = c("Heated", "Unheated")) +
   scale_x_datetime(date_labels = "%b %d", date_breaks="3 days") 

p6 + plottheme + theme(legend.position = c(.1, .9))
 
#ggsave("flagged_UavgHavg_1h_2016_5.png", path="plots/outliers_omitted/2016", width = 14, height = 7, dpi = 300)
ggsave("flagged_UavgHavg_1h_2015.png", path="plots/outliers_omitted/2015", width = 14, height = 7, dpi = 300)

#4-hour averages
heatstat.4hour.avg <- gather(mean.4hour.depthavg, key="Heatstat", value="temp_4hour", 3:4)

p7 <- ggplot(heatstat.4hour.avg %>% filter(block %in% c(1,2,3,4)), aes(y = temp_4hour, x = time_4hour, color = Heatstat)) +
   geom_point(pch = 1, size = 0.5) +
   ylab(expression("Temperature" ~ (degree * C))) +
   xlab("Time") +
   scale_color_discrete(name = "Heater status", breaks = c("HeatedMean", "UnheatedMean"), labels = c("Heated", "Unheated")) +
   scale_x_datetime(date_labels = "%b %d", date_breaks="3 days") 

p7 + plottheme + theme(legend.position = c(.1, .9))
 
#ggsave("flagged_UavgHavg_4h_2016_5.png", path="plots/outliers_omitted/2016", width = 14, height = 7, dpi = 300)
ggsave("flagged_UavgHavg_4h_2015.png", path="plots/outliers_omitted/2015", width = 14, height = 7, dpi = 300)

#6-hour averages
heatstat.6hour.avg <- gather(mean.6hour.depthavg, key="Heatstat", value="temp_6hour", 3:4)

p8 <- ggplot(heatstat.6hour.avg %>% filter(block %in% c(1,2,3,4)), aes(y = temp_6hour, x = time_6hour, color = Heatstat)) +
   geom_point(pch = 1, size = 0.5) +
   ylab(expression("Temperature" ~ (degree * C))) +
   xlab("Time") +
   scale_color_discrete(name = "Heater status", breaks = c("HeatedMean", "UnheatedMean"), labels = c("Heated", "Unheated")) +
   scale_x_datetime(date_labels = "%b %d", date_breaks="3 days") 

p8 + plottheme + theme(legend.position = c(.1, .9))
 
#ggsave("flagged_UavgHavg_6h_2016_5.png", path="plots/outliers_omitted/2016", width = 14, height = 7, dpi = 300)
ggsave("flagged_UavgHavg_6h_2015.png", path="plots/outliers_omitted/2015", width = 14, height = 7, dpi = 300)
```

####Plot 3: Temperature in heated and unheated plots within each block at each depth, using 15-min averaged data
You can see that heating effects vary widely among different blocks and depths. 
```{r}
#15-min averages
chambers <- mean.15min 

mean.15min$time_15min <- as.POSIXct(mean.15min$time_15min)

for(i in 1:length(unique(chambers$block))){
  plot <- unique(chambers$block)[i]
  
  p9 <- ggplot(mean.15min %>% filter(block == plot), aes(y = temp, x = time_15min, color = heatStat)) +
  geom_point(pch = 1, size = 0.5) +
  facet_grid(depth~.) +
  ylab(expression("Temperature" ~ (degree * C))) +
  ggtitle(paste("Block", plot)) +
  xlab("Time") +
  scale_x_datetime(date_labels = "%b %d", date_breaks="3 days") +
  scale_color_discrete(name = "Heater status", breaks = c("H", "U"), labels = c("Heated", "Unheated")) 
  
print(p9 + plottheme)

#ggsave(file = paste("flagged_", plot, "_15min_tempdepth_2016_5.png", sep=""), path="plots/outliers_omitted/2016", width = 8.5, height = 11, dpi = 300)
ggsave(file = paste("flagged_", plot, "_15min_tempdepth_2015.png", sep=""), path="plots/outliers_omitted/2015", width = 8.5, height = 11, dpi = 300)

}

#1-hour averages
chambers <- mean.hour 

mean.hour$time_hour <- as.POSIXct(mean.hour$time_hour)

for(i in 1:length(unique(chambers$block))){
  plot <- unique(chambers$block)[i]
  
  p10 <- ggplot(mean.hour %>% filter(block == plot), aes(y = temp, x = time_hour, color = heatStat)) +
  geom_point(pch = 1, size = 0.5) +
  facet_grid(depth~.) +
  ylab(expression("Temperature" ~ (degree * C))) +
  ggtitle(paste("Block", plot)) +
  xlab("Time") +
  scale_x_datetime(date_labels = "%b %d", date_breaks="3 days") +
  scale_color_discrete(name = "Heater status", breaks = c("H", "U"), labels = c("Heated", "Unheated")) 
  
print(p10 + plottheme)

#ggsave(file = paste("flagged_", plot, "_1h_tempdepth_2016_5.png", sep=""), path="plots/outliers_omitted/2016", width = 8.5, height = 11, dpi = 300)
ggsave(file = paste("flagged_", plot, "_1h_tempdepth_2016_5.png", sep=""), path="plots/outliers_omitted/2015", width = 8.5, height = 11, dpi = 300)

}

#4-hour averages
chambers <- mean.6hour 

mean.4hour$time_4hour <- as.POSIXct(mean.4hour$time_4hour)

for(i in 1:length(unique(chambers$block))){
  plot <- unique(chambers$block)[i]
  
  p11 <- ggplot(mean.4hour %>% filter(block == plot), aes(y = temp, x = time_4hour, color = heatStat)) +
  geom_point(pch = 1, size = 0.5) +
  facet_grid(depth~.) +
  ylab(expression("Temperature" ~ (degree * C))) +
  ggtitle(paste("Block", plot)) +
  xlab("Time") +
  scale_x_datetime(date_labels = "%b %d", date_breaks="3 days") +
  scale_color_discrete(name = "Heater status", breaks = c("H", "U"), labels = c("Heated", "Unheated")) 
  
print(p11 + plottheme)

#ggsave(file = paste("flagged_", plot, "_4h_tempdepth_2016_5.png", sep=""), path="plots/outliers_omitted/2016", width = 8.5, height = 11, dpi = 300)
ggsave(file = paste("flagged_", plot, "_4h_tempdepth_2016_5.png", sep=""), path="plots/outliers_omitted/2015", width = 8.5, height = 11, dpi = 300)

}

#6-hour averages
chambers <- mean.6hour 

mean.6hour$time_6hour <- as.POSIXct(mean.6hour$time_6hour)

for(i in 1:length(unique(chambers$block))){
  plot <- unique(chambers$block)[i]
  
  p12 <- ggplot(mean.6hour %>% filter(block == plot), aes(y = temp, x = time_6hour, color = heatStat)) +
  geom_point(pch = 1, size = 0.5) +
  facet_grid(depth~.) +
  ylab(expression("Temperature" ~ (degree * C))) +
  ggtitle(paste("Block", plot)) +
  xlab("Time") +
  scale_x_datetime(date_labels = "%b %d", date_breaks="3 days") +
  scale_color_discrete(name = "Heater status", breaks = c("H", "U"), labels = c("Heated", "Unheated")) 
  
print(p12 + plottheme)

#ggsave(file = paste("flagged_", plot, "_6h_tempdepth_2016_5.png", sep=""), path="plots/outliers_omitted/2016", width = 8.5, height = 11, dpi = 300)
ggsave(file = paste("flagged_", plot, "_6h_tempdepth_2016_5.png", sep=""), path="plots/outliers_omitted/2015", width = 8.5, height = 11, dpi = 300)

}

```

####Plot 5: Temperature for each probe (dist x depth) in heated and unheated blocks
```{r}
#Averaged hourly
mean.hour.probe <- mean.hour.probe %>% mutate(probe = paste(type, dist, .sep = " "))

chambers <- mean.hour.probe 

for(i in 1:length(unique(chambers$block))){
  plot <- unique(chambers$block)[i]
  
  p5 <- ggplot(mean.hour.probe %>% filter(block == plot), aes(y = temp, x = time_hour, color = heatStat)) +
  geom_point(pch = 1, size = 0.5) +
  facet_grid(depth ~ probe) +
  ylab(expression("Temperature" ~ (degree * C))) +
  ggtitle(paste("Block", plot)) +
  xlab("Time") +
  scale_x_datetime(date_labels = "%b %d", date_breaks="3 days") +
  scale_color_discrete(name = "Heater status", breaks = c("H", "U"), labels = c("Heated", "Unheated")) 
  
print(p5 + plottheme)

#ggsave(file = paste("flagged_", plot, "_1h_probe_tempdepth_2016_4.png", sep=""), path="plots/outliers_omitted/2016", width = 16, height = 11, dpi = 300)
ggsave(file = paste("flagged_", plot, "_1h_probe_tempdepth_2016_4.png", sep=""), path="plots/outliers_omitted/2015", width = 16, height = 11, dpi = 300)

}

#Averaged every 15 minutes
mean.15min.probe <- mean.15min.probe %>% mutate(probe = paste(type, dist, .sep = " "))

chambers <- mean.15min.probe 

for(i in 1:length(unique(chambers$block))){
  plot <- unique(chambers$block)[i]
  
  p5 <- ggplot(mean.15min.probe %>% filter(block == plot), aes(y = temp, x = time_15min, color = heatStat)) +
  geom_point(pch = 1, size = 0.5) +
  facet_grid(depth ~ probe) +
  ylab(expression("Temperature" ~ (degree * C))) +
  ggtitle(paste("Block", plot)) +
  xlab("Time") +
  scale_x_datetime(date_labels = "%b %d", date_breaks="3 days") +
  scale_color_discrete(name = "Heater status", breaks = c("H", "U"), labels = c("Heated", "Unheated")) 
  
print(p5 + plottheme)

#ggsave(file = paste("flagged_", plot, "_15min_probe_tempdepth_2016_4.png", sep=""), path="plots/outliers_omitted/2016", width = 16, height = 11, dpi = 300)
ggsave(file = paste("flagged_", plot, "_15min_probe_tempdepth_2016_4.png", sep=""), path="plots/outliers_omitted/2015", width = 16, height = 11, dpi = 300)

}
```